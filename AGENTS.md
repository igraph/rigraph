# AI Agent Development Guidelines for igraph

> **Note**: For GitHub Copilot-specific instructions, see [`.github/copilot-instructions.md`](.github/copilot-instructions.md).

## Project Overview

igraph is an R package for network analysis and graph theory.
It provides routines for simple graphs and network analysis, handles large graphs efficiently, and includes functions for generating random and regular graphs, graph visualization, centrality methods, and much more.

## Key Technologies

- **Language**: R with C/C++ backend (uses the igraph C library)
- **Testing**: testthat framework
- **Documentation**: roxygen2 with Markdown syntax
- **Code Formatting**: air (R formatting tool)
- **Build System**: R CMD, devtools, Makefile
- **Code Generation**: Stimulus framework (see `tools/README.md`)

## Development Setup

### Installation and Dependencies

```r
# Install all dependencies
pak::pak()
# Install build dependencies
pak::pak(dependencies = "Config/Needs/build")
```

### Install and run R

- When run on GitHub Actions, assume that R, the package in its current state and all dependencies are installed.
- Only install new packages when needed for implementing new features or tests.
- Run `R -q -e 'testthat::test_local(reporter = "check")'` to execute tests as a final step.

### Building and Testing

- Load package for development: `pkgload::load_all()`
- Run tests: `testthat::test_local(reporter = "check")` or `R -q -e 'testthat::test_local(reporter = "check")'`
- Build package: `devtools::build()`
- Check package: `devtools::check()`
- Update documentation: `devtools::document()` or `R -q -e 'devtools::document()'`
- Format code: `air format .`

## Code Style and Documentation

### PR and Commit Style

- PRs and commits use the conventional commit style with backticks for code references such as `function_call()`
- PRs are generally squashed, a clean history within a PR is not necessary

### Comment Style

- Add comprehensive comments to utility functions that aren't immediately obvious
- Use line breaks after each sentence in multi-sentence comments
- Focus comments on explaining the "why" and "how", the "what" should be clear from the code itself
- Include context about the function's role in the testing framework

### R Code Conventions

- Follow the [tidyverse style guide](https://style.tidyverse.org)
- Use snake_case for new functions (some legacy functions use camelCase)
- Use explicit package prefixes (e.g., `withr::local_db_connection()`) for clarity
- Maintain consistent indentation (2 spaces) and spacing patterns
- Use meaningful variable names that reflect context
- Run `air format .` before committing changes to ensure consistent formatting

### Documentation

- Use roxygen2 with Markdown syntax for all function documentation
- Keep each sentence on its own line in roxygen2 comments for better readability
- Document internal functions using devtag (work in progress)
- Link to C documentation using `@cdocs` tag: `#' @cdocs igraph_function_name`
- Always run `devtools::document()` after updating documentation

### Naming Conventions

- Use `max` for maximal (graph theory term: a vertex is maximal if no other vertex dominates it) and `largest` for maximum (the biggest value in a set)
- Align script and test names: code in `R/name.R` should be tested in `tests/testthat/test-name.R`

## File Structure and Organization

### Test Files

- Test files should align with source files
- `R/name.R` â†’ `tests/testthat/test-name.R`
- Use `usethis::use_test()` and `usethis::use_r()` to toggle between files

### Generated Files

**Do not modify these files directly:**
- `src/rinterface.c` (generated by Stimulus)
- `R/aaa-auto.R` (generated by Stimulus)

Update them using: `make -f Makefile-cigraph src/rinterface.c R/aaa-auto.R`

See `tools/README.md` for guidelines on code generation using the Stimulus framework.

## Testing

- Use testthat for unit tests
- Add test cases for all new functionality
- Test file naming should mirror source file naming
- Run tests frequently during development: `testthat::test_local()`
- Final check before PR: `R -q -e 'testthat::test_local(reporter = "check")'`

## Common Pitfalls

- Don't install new packages unless absolutely necessary for new features or tests. Prefer base R or existing package solutions when feasible.
- Don't restyle unrelated code in a PR
- Ensure parent directories exist before creating files
- On Windows, ensure RTools is installed and system requirements (glpk, libxml2) are met
- Don't modify generated files directly (e.g., `src/rinterface.c`, `R/aaa-auto.R`)

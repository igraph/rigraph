# GitHub Copilot Instructions for igraph/rigraph

## Project Overview

igraph is an R package for network analysis and graph theory.
It provides routines for simple graphs and network analysis, handles large graphs efficiently, and includes functions for generating random and regular graphs, graph visualization, centrality methods, and much more.

## Key Technologies

- **Language**: R with C/C++ backend (uses the igraph C library)
- **Testing**: testthat framework
- **Documentation**: roxygen2 with Markdown syntax
- **Code Formatting**: air (R formatting tool)
- **Build System**: R CMD, devtools, Makefile
- **Code Generation**: Stimulus framework (see `tools/README.md`)

## Development Setup

### Installation and Dependencies

```r
# Install all dependencies
pak::pak()
# Install build dependencies
pak::pak(dependencies = "Config/Needs/build")
```

### Building and Testing

- Load package for development: `pkgload::load_all()`
- Run tests: `testthat::test_local(reporter = "check")` or `R -q -e 'testthat::test_local(reporter = "check")'`
- Build package: `devtools::build()`
- Check package: `devtools::check()`
- Update documentation: `devtools::document()` or `R -q -e 'devtools::document()'`
- Format code: `air format .`

### Testing on GitHub Actions

When running in CI/CD, assume R, the package, and all dependencies are already installed.

## Code Style Guidelines

### R Code Conventions

- Follow the [tidyverse style guide](https://style.tidyverse.org)
- Use snake_case for new functions (some legacy functions use camelCase)
- Use explicit package prefixes for clarity (e.g., `withr::local_db_connection()`)
- Maintain consistent indentation (2 spaces) and spacing patterns
- Use meaningful variable names that reflect context
- **Always format code with `air format .` before committing**

### Documentation

- Use roxygen2 with Markdown syntax for all function documentation
- Keep each sentence on its own line in roxygen2 comments for better readability
- Document internal functions using devtag (work in progress)
- Link to C documentation using `@cdocs` tag: `#' @cdocs igraph_function_name`
- Always run `devtools::document()` after updating documentation

### Comments

- Add comprehensive comments to utility functions that aren't immediately obvious
- Use line breaks after each sentence in multi-sentence comments
- Focus on explaining the "why" and "how", not the "what" (code should be self-explanatory)
- Include context about the function's role in the larger framework

### Naming Conventions

- Use `max` for maximal (graph theory term: a vertex is maximal if no other vertex dominates it) and `largest` for maximum (the biggest value in a set)
- Align script and test names: code in `R/name.R` should be tested in `tests/testthat/test-name.R`

### Commit and PR Style

- Use conventional commit style
- Use backticks for code references: `function_call()`
- PRs are generally squashed, so clean history within a PR is not critical
- PR titles should briefly describe the change
- PR bodies should contain `Fixes #issue-number` when applicable

## File Structure and Organization

### Test Files

- Test files should align with source files
- `R/name.R` â†’ `tests/testthat/test-name.R`
- Use `usethis::use_test()` and `usethis::use_r()` to toggle between files

### Generated Files

- `src/rinterface.c` and `R/aaa-auto.R` are generated by Stimulus
- Update them with: `make -f Makefile-cigraph src/rinterface.c R/aaa-auto.R`
- See `tools/README.md` for code generation guidelines

## Making Changes

### For Small Changes

1. Edit files directly
2. Run `air format .` to format
3. Update documentation with `devtools::document()` if needed
4. Test with `testthat::test_local()`

### For Larger Changes

1. Consider opening an issue first to discuss
2. Make changes in small, focused commits
3. Add or update tests for new functionality
4. Update documentation
5. Format code with `air format .`
6. Run full test suite
7. Run `devtools::check()` to ensure package passes R CMD check

### Working with C Library

If changes involve the igraph C library, those changes must be made first in the C library repository: https://github.com/igraph/igraph

Then vendor the changes using:
```sh
./vendor.sh <path-to-cigraph-working-copy>
```

## Testing

- Use testthat for unit tests
- Add test cases for all new functionality
- Test file naming should mirror source file naming
- Run tests frequently during development: `testthat::test_local()`
- Final check before PR: `R -q -e 'testthat::test_local(reporter = "check")'`

## Common Pitfalls

- Don't install new packages unless absolutely necessary for new features or tests. Prefer base R or existing package solutions when feasible. Evaluate necessity by checking if functionality can be implemented with existing tools.
- Don't restyle unrelated code in a PR
- Ensure parent directories exist before creating files
- On Windows, ensure RTools is installed and system requirements (glpk, libxml2) are met. For R >= 4.0, install these from an RTools terminal: `pacman -Sy mingw-w64-{i686,x86_64}-glpk mingw-w64-{i686,x86_64}-libxml2`. See README.md for more details.
- Don't modify generated files directly (e.g., `src/rinterface.c`, `R/aaa-auto.R`)

## Resources

- [Package website](https://r.igraph.org/)
- [Get started vignette](https://r.igraph.org/articles/igraph.html)
- [Reference index](https://r.igraph.org/reference/index.html)
- [Contributing guide](CONTRIBUTING.md)
- [C library repository](https://github.com/igraph/igraph)
- [Code of Conduct](https://igraph.org/code-of-conduct.html)

## Additional AI Agent Instructions

For AI agents and automated tools, see the `AGENTS.md` file in the repository root for specific guidelines tailored to automated development workflows.
